#A renommer en .htaccess

# Blocage de l'accès au site pour maintenance urgente (bug grave, piratage, tout est cassé) : Décommentez les lignes suivantes pour bloquer l'accès au site
#order deny,allow
#deny from all
#ErrorDocument 403 /maintenance.html
#allow from 2001:cb00:... # Mettre l'adresse du développeur qui veut y accéder ici, ou plusieurs ligne possible (format ipv6 oiu ipv4
#allow from 2001:bc8:37ca:101::1 # Mettre l'adresse du serveur (pour les requettes AJAX intra-site)
#<FilesMatch "^maintenance.html$">
#  Allow from all
#</FilesMatch>

#Notre code est public, c'est donc pas vraiment par sécurité mais parce que ça met dans lignes d'erreur dans nos logs (Et au cas où on commiterait par erreur un mot de passe). Ces pirates, ils tentent vraiment n'importe quoi...
RedirectMatch 403 ^/.git/.*$


AddDefaultCharset UTF-8

RewriteEngine On
# Ici on détecte si la connexion a lieu par http ou https et on stock dans la variable "proto"
RewriteCond %{HTTPS} =on
RewriteRule ^(.*)$ - [env=proto:https]
RewriteCond %{HTTPS} !=on
RewriteRule ^(.*)$ - [env=proto:http]

# On peut ensuite forcer la redirection de refuges.info vers www.refuges.info en préservant le protocol (http ou https)
RewriteCond %{HTTP_HOST} ^refuges.info$ [NC]
RewriteRule ^(.*)$ %{ENV:proto}://www.refuges.info/$1 [L,R=301]

#Ces règles de rewrite permettent de faire atterrir tous les appels sur
#l'unique point d'entrée du site (moins le forum et de vieux truc non
#converti) sauf ceux pour lesquels il existe un fichier réél ou un dossier
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . ./index.php [L]

#A n'activer que si on utilise mod_php de apache sinon on il faudra le mettre dans la config php.ini
#php_value short_open_tag 1

#A décommenter pour les développeurs : ça affiche les erreurs à l'écran même celle de parse error (uniquement si on utilise mod_php, ce qui, en 09/02/2021 n'est plus le cas)
#php_value display_errors 1


#Ces options de mise en cache navigateur ne pas une nécessité, mais pour le css et le js ça accélère quand même bigrement la navigation sur le site
#Si le module n'existe pas avec apache, tant pis, ça ne fera rien (mais c'est dommage !)
<ifmodule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/css "access plus 6 hours"
  ExpiresByType application/javascript "access plus 6 hours"
  ExpiresByType image/png "access plus 12 hours"
  ExpiresByType image/jpg "access plus 6 hours"
  ExpiresByType image/jpeg "access plus 6 hours"
</ifmodule>
